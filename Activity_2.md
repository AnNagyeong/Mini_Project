# Activity_2 시스템 구성 요소

[ 스케줄러 ]  
- 실행 주기 : 5분
- 방식 : cron or systemd timer  
- 현재 시간 기준, 출석 마감 임박 수업 탐색, 알림 대승 선별


[ 알림 대상 ]  
1. 수업 날짜가 이번 주에 해당함  
> (월 ~ 일 기준 또는 학사 기준 주차)  
2. 출석 상태가 출석이 아님  
> (미출석 / 지각 / 미확인 포함)  
3. 현재 시간이 출석 마감 이전  
> (출석 마감 시간 - 현재 시간) ≤ 알림 기준 시간 (5시간)  
4. 해당 수업에 대해 이미 동일한 알림을 발송한 이력이 없음  

[ API ]  
1. 출석 대상 조회 API
  - 이번 주 수업 중 출석 미완료인 사용자 조회  
2. 알림 발송 API
  - 이메일 알림 발송
  - 알림 발송 결과 저장, 중복 알림 방지를 위해 DB와 연동  

[ 이메일 알림 설계 ]  

제목 -[코스모스] 출석 마감 5시간 전 알림  

본문..  

안녕하세요. [데이터베이스] 수업의 출석 마감 시간이 5시간 남았습니다.  
지각/결석 처리되지 않도록 금일 내에 출석을 진행해 주세요.  

[ 데이터베이스 설계 ]  
| 필드명          | 타입(예시)  | 설명                       |
| --------------- | ----------- | --------------------------- |
| notification_id | BIGINT (PK) | 알림 고유 ID                |
| user_id         | BIGINT (FK) | 사용자 ID                   |
| class_id        | BIGINT (FK) | 수업 ID                     |
| type            | VARCHAR     | 알림 타입 (`ATTENDANCE_5H`) |
| scheduled_for   | DATETIME    | 알림 기준 시각 (마감 - 5)   |
| sent_at         | DATETIME    | 실제 발송 시각              |
| status          | VARCHAR     | `SUCCESS` / `FAILED`        |
| created_at      | DATETIME    | 생성 시각                   |


---

[ 실패/예외 처리 ]     
- 메일 발송 실패  
> 재시도 1회  
> 실패 로그 기록    

- 서버 재부팅  
> 스케줄러 자동 재실행

- 알림 발송 중 출석 완료  
> 즉시 대상 제외  

